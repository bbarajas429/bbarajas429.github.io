{
  "hash": "4f699cba8da4bab5a452ea10c96b8e44",
  "result": {
    "markdown": "---\ntitle: 'NDVI Assessment Around Santa Clara River'\ndescription: 'Calculating NDVI using Landsat remote sensing data around the Santa Clara River area'\nauthor: \n  - name: \"Briana Barajas\"\n    url: https://briana-barajas.github.io/\n    affiliation: MEDS\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 12-15-2023\ncategories: [MEDS, R, Remote sensing]\ncitation:\n  url: https://github.com/briana-barajas/santa-clara-river-ndvi\nimage: sc-river.jpeg\ndraft: false\nfootnotes-hover: true\noutput: html_document\nformat: \n  html:\n    code-fold: true\n    code-summary: \"View Code\"\n---\n\n\n\n\n## Background\n\nWhile many organisms in nature experience phenological cycles, plant phenology is one of the most easily recognized. Phenological events for plants include leaf growth, flowering, and leaf death (also known as *senescence*). The timing of these events is based on climate conditions, so that plants may ensure successful reproduction. As the climate changes, phenological cycles in plants can be disrupted. For this reason, changes in plant phenology are used to estimate how ecosystems are responding to climate change.\n\nThis analysis utilizes satellite data to calculate the normalized difference vegetation index (NDVI) for various plant communities. Looking at NDVI over time can uncover some of the phenological cycles, but more importantly, long-term trends that might be caused by climate change. The area of interest for this study is the Santa Clara River, which has the following plant communities:\n\n-   **riparian forests**: grow along the river, dominated by winter deciduous cottonwood and willow trees\n-   **grasslands**: grow in openspaces, dominated by drought deciduous grasses\n-   **chaparral shrublands**: grow in more arid habitats, dominated by evergreen shrubs\n\ncredit: this post is based on a materials developed by Chris Kibler with additional assistance from Ruth Oliver\n\n## About the Data\n\n### River Data\n\nA shape file of rivers in Ventura County is publicly available via the [Ventura County Watershed Protection District](https://ventura-county-watershed-protection-district-gis-data-vcwpd.hub.arcgis.com/search). To provide a base map for this, I have also loaded vector data on counties in the United States.\n\n### Landsat Data\n\nThe data that will be used to calculate NDVI is from the Landsat Operational Land Imager (OLI) sensor. There are 8 total landsat `.tif` files that contain level 3 surface reflectance products where erroneous values were set to NA, the scale factor is set to 100, and bands 2-7 are present. The date of collection is at the end of each file name.\n\n### Study Sites\n\nStudy sites are available as vector data with character strings as the plant type. This data will be used to classify the plant communities of interest.\n\n## Compute Initial NDVI\n\nNDVI was computed for all 8 Landsat images. The date range is between June 2018 and July 2019. Ideally, this time frame will provide an accurate estimate of annual phonological changes in NDVI.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n**Preparation:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create NDVI function\nndvi_fun = function(nir, red){\n  (nir - red) / (nir + red)\n}\n\n# create list of landsat files\nlandsat_files <- list.files(here('blog-posts','2023-12-15-santa-clara-ndvi',\"data\"), pattern = \"*.tif\", full.names = TRUE)\n```\n:::\n\n\n**NDVI Across Scenes:**\n\nIn order to facilitate NDVI calculation, the function below is designed to read in all raster files, rename their bands, and calculate NDVI. Once all NDVI's were calculated, they were stacked and assigned names that corresponded to their date.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#function reads in data, renames bands, and calc NDVI\ncreate_ndvi_layer <- function(i){\n  landsat <- rast(landsat_files[i]) #read in data \n  names(landsat) <- c(\"blue\", \"green\", \"red\", \"NIR\", \"SWIR1\", \"SWIR2\") #rename bands\n  ndvi <- lapp(landsat[[c(4, 3)]], fun = ndvi_fun) #NDVI\n}\n\n# stack raster with NDVI data using function above\nall_ndvi <- c(create_ndvi_layer(1),\n              create_ndvi_layer(2),\n              create_ndvi_layer(3),\n              create_ndvi_layer(4),\n              create_ndvi_layer(5),\n              create_ndvi_layer(6),\n              create_ndvi_layer(7),\n              create_ndvi_layer(8))\n\n# add dates to corresponding layer\nnames(all_ndvi) <- c(\"2018-06-12\",\n                     \"2018-08-15\",\n                     \"2018-10-18\",\n                     \"2018-11-03\",\n                     \"2019-01-22\",\n                     \"2019-02-23\",\n                     \"2019-04-12\",\n                     \"2019-07-01\")\n```\n:::\n\n\n## Exploratory Maps\n\n#### True Color Image\n\nAssessing true color imagery before NDVI can be useful for quickly recognizing different types of terrain. Here, I created a simple true color image of the Santa Clara River area using one of a single Landsat from June 2018.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a true color image\nplotRGB(single_landsat_rast, 3, 2, 1, stretch=\"hist\",\n        main = \"Santa Clara River True Color Image\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n#### **Study Site Location Along Santa Clara Watershed**\n\nThe Santa Clara River flows from Santa Clarita to Ventura and remains relatively natural compared to other rivers in California. It is recognized for its ecological importance and natural resource potential, as the river provides water for agriculture and habitat for several endangered species. For these reasons, there have been significant efforts to conserve and restore the riparian habitat surrounding the river[^1].\n\n[^1]: \"Santa Clara River.\" *The Nature Conservancy*, www.nature.org/en-us/get-involved/how-to-help/places-we-protect/the-nature-conservancy-in-california-santa-clara-river-california-con/#:\\~:text=The%20Santa%20Clara%20River%20is%20a%20vital%20source%20of%20drinking,bustling%20Los%20Angeles%2DVentura%20region. Accessed 15 Dec. 2023.\n\nThe following visualization depicts the Santa Clara River, as well as other rivers within the Santa Clara Watershed. The plant communities (study sites) were added as well for geographical context.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## ========== Data Preparation ==========\n# filter VC river data to SC watershed\nsc_watershed <- vc_rivers %>% \n  filter(WATERSHED == \"SANTA CLARA RIVER WATERSHED\") %>% #filter\n  st_transform(crs = 'epsg:32611') %>% #reproject\n  st_crop(study_sites)\n\n# filter state data to counties new watershed\nventura <- states %>% st_crop(study_sites) #crop county to watershed\n\n# create custom color palette\nphenology_pal <- c(\"#EAAC8B\", \"#315C2B\", \"#315C2B\", \"#315C2B\",\"#9EA93F\")\n\n## ========== Plot Data Together ==========\n# create map combining watershed, study sites, and counties\nggplot() +\n  geom_sf(data = ventura, fill = '#E7DED9') +\n  geom_sf(data = sc_watershed, color = 'dodgerblue') +\n  geom_sf(data = study_sites,\n          mapping = aes(fill = study_site)) +\n  scale_fill_manual(values = phenology_pal) +\n  labs(title = \"Study Sites Along Santa Clara Watershed\",\n       fill = \"Plant Communities\",\n       x=NULL,\n       y=NULL) +\n  theme(panel.background = element_rect(fill='lightblue'),\n        plot.margin=grid::unit(c(0,0,0,0), \"mm\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n#### Study Sites and NDVI\n\nThis map demonstrates study sites within a single NDVI layer. For simplicity, I will call the first layer from the `all_ndvi` raster stack.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(all_ndvi[[1]]) +\n  tm_raster() +\n  tm_shape(study_sites) +\n  tm_polygons()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThe normalized vegetation index (NDVI) can be used to estimate plant productivity. Areas with sparse foliage will return lower values, while areas with dense leaf cover will return values closer to 1. The NDVI scale ranges from -1 to 1, but vegetation is commonly a positive value. A negative NDVI is indicative of water, either as clouds, snow, or bodies of water on the Earth's surface. For this reason, cloud cover can potentially affect NDVI values calculated from remotely sensed data.\n\n## NDVI Within Study Sites\n\n#### Data Cleaning\n\nBefore the final plot can be produced, the average NDVI within each study site must be isolated. This was done using the `extract()` function from the `terra` package, followed by `cbind` to combine NDVI values with the original study site data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## ========== Find NDVI within sites ==========\n# use extract to pull NDVI values\nsites_ndvi <- terra::extract(all_ndvi, study_sites, fun = 'mean')\n\n# bind site data w/ site specific NDVI\nsites_ndvi_raw <- cbind(study_sites, sites_ndvi)\n\n## ========== Clean Data frame =========\nsites_clean <- sites_ndvi_raw %>% \n  st_drop_geometry() %>%\n  select(-ID) %>%\n  pivot_longer(!study_site) %>%\n  rename(\"NDVI\" = value) %>%\n  mutate(\"year\" = str_sub(name, 2, 5),\n         \"month\" = str_sub(name, 7, 8),\n         \"day\" = str_sub(name, -2, -1)) %>%\n  unite(\"date\", 4:6, sep = \"-\") %>%\n  mutate(\"date\" = lubridate::as_date(date))\n```\n:::\n\n\n#### Plot NDVI Over Time\n\nPlotting NDVI over time can ideally give us insight into the phonological trends mentioned in the introduction. Typically, NDVI values will be lower in the winter when trees lose their leaves, and higher in the spring. Plotting all study sites together makes it easy to note differences in NDVI among different plant communities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sites_clean,\n       aes(x = date, y = NDVI,\n           group = study_site, col = study_site)) +\n  scale_color_manual(values = phenology_pal) +\n  geom_line() +\n  theme_minimal() +\n  labs(x = \"\", y = \"Normalized Difference Vegetation Index (NDVI)\", col = \"Plant Communities\",\n       title = \"Seasonal cycles of vegetation productivity\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Conclusion\n\nHigher NDVI values often correlate with denser vegetation and times of rapid growth. Based on the plot produced, grasslands and chaparral sites appear to have faster growth in the springtime. Most notably, however, it appears that grasslands are ill equipped for winter as the NDVI from the end of 2018 is rather low. To expand this analysis, it would be useful to data beyond just one year. It is possible this year was not an accurate representation, and additional data would uncover this. With enough data, you could also minimize seasonal cycles to uncover trends that are only visible over several years.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}